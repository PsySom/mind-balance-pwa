# AI –î–Ω–µ–≤–Ω–∏–∫ - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
4. [–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã](#–ª–æ–≥–∏–∫–∞-—Ä–∞–±–æ—Ç—ã)
5. [–°—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](#—Å—Ü–µ–Ω–∞—Ä–∏–∏-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
6. [API –∏ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#api-–∏-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
7. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–∏-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

---

## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

AI –î–Ω–µ–≤–Ω–∏–∫ - —ç—Ç–æ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–∏–∫–∞ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º, –∫–æ—Ç–æ—Ä–∞—è:

- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é —Å–µ—Å—Å–∏–π –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ WebSocket (Realtime)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Ä–µ–∂–∏–º–∞: Production (—Ä–µ–∞–ª—å–Ω—ã–π API) –∏ Mock (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ß–∞—Ç —Å AI –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–∏–∞–ª–æ–≥–æ–≤
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (suggestions)
- ‚úÖ –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏ –¥–ª—è AI –æ—Ç–≤–µ—Ç–æ–≤
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Frontend (React)                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Components:                                                 ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                 ‚îÇ
‚îÇ  ‚îÇ AIDiaryChat     ‚îÇ  ‚îÇ FreeChat         ‚îÇ                 ‚îÇ
‚îÇ  ‚îÇ (entry point)   ‚îÇ‚Üí ‚îÇ (main container) ‚îÇ                 ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                 ‚îÇ
‚îÇ         ‚îÇ                      ‚îÇ                             ‚îÇ
‚îÇ         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ         ‚Üì                      ‚Üì             ‚Üì              ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ FreeChatHeader‚îÇ  ‚îÇ FreeChatMessages‚îÇ  ‚îÇFreeChatInput‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                            ‚îÇ                                 ‚îÇ
‚îÇ                            ‚Üì                                 ‚îÇ
‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                         ‚îÇ
‚îÇ                    ‚îÇ ChatMessage   ‚îÇ                         ‚îÇ
‚îÇ                    ‚îÇ QuickSuggestions‚îÇ                       ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Hooks:                                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îÇ
‚îÇ  ‚îÇ useAIDiaryChat   ‚îÇ  ‚îÇ useAIDiaryAnalytics ‚îÇ            ‚îÇ
‚îÇ  ‚îÇ (main logic)     ‚îÇ  ‚îÇ (statistics)        ‚îÇ            ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Services:                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ ai-diary.service.ts     ‚îÇ  ‚îÇ ai-diary-sessions.service‚îÇ‚îÇ
‚îÇ  ‚îÇ (API communication)     ‚îÇ  ‚îÇ (session management)     ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Backend (Webhook + Supabase)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Webhook: https://mentalbalans.com/webhook/ai-diary-message ‚îÇ
‚îÇ  ‚Üì                                                           ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                   ‚îÇ
‚îÇ  ‚îÇ AI Processing (n8n)  ‚îÇ                                   ‚îÇ
‚îÇ  ‚îÇ - Emotion analysis   ‚îÇ                                   ‚îÇ
‚îÇ  ‚îÇ - Response generation‚îÇ                                   ‚îÇ
‚îÇ  ‚îÇ - Suggestions        ‚îÇ                                   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ
‚îÇ           ‚Üì                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ
‚îÇ  ‚îÇ Supabase Database                      ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ - ai_diary_sessions                    ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ - ai_diary_messages                    ‚îÇ                ‚îÇ
‚îÇ  ‚îÇ - Realtime subscriptions               ‚îÇ                ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ AIDiaryChat.tsx                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (wrapper)
‚îÇ   ‚îî‚îÄ‚îÄ dashboard/ai-diary/
‚îÇ       ‚îú‚îÄ‚îÄ FreeChat.tsx                     # –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞
‚îÇ       ‚îú‚îÄ‚îÄ FreeChatHeader.tsx               # –•–µ–¥–µ—Ä —Å –∫–Ω–æ–ø–∫–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ FreeChatMessages.tsx             # –°–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ       ‚îú‚îÄ‚îÄ FreeChatInput.tsx                # –ü–æ–ª–µ –≤–≤–æ–¥–∞
‚îÇ       ‚îú‚îÄ‚îÄ ChatMessage.tsx                  # –û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
‚îÇ       ‚îú‚îÄ‚îÄ QuickSuggestions.tsx             # –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
‚îÇ       ‚îî‚îÄ‚îÄ AIDiaryStats.tsx                 # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useAIDiaryChat.ts                    # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —á–∞—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ useAIDiaryAnalytics.ts               # –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ useAuth.ts                           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ ai-diary.service.ts                  # API –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ ai-diary-sessions.service.ts         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îÇ
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ (ChatMessage, DiarySession)          # TypeScript —Ç–∏–ø—ã
```

---

## ‚öôÔ∏è –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (useAIDiaryChat)

**–ü—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:**

```typescript
useEffect(() => {
  if (!user) return;
  
  // 1. –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é –∏–∑ localStorage
  const currentSessionId = aiDiaryService.getCurrentSessionId();
  
  if (currentSessionId) {
    // 2a. –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –µ—Å—Ç—å ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
    const messages = await aiDiarySessionsService.getSessionMessages(currentSessionId);
    setMessages(convertToDisplay(messages));
    
    // 2b. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ Realtime –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    subscribeToSession(currentSessionId);
  } else {
    // 3. –ï—Å–ª–∏ —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    showWelcomeMessage();
  }
}, [user]);
```

### 2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (sendMessage)

**–ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**

```typescript
async function sendMessage(messageText: string) {
  // –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–µ—Å—Å–∏–∏
  if (!sessionId) {
    const newSession = await aiDiarySessionsService.createSession(user.id);
    setSessionId(newSession.session_id);
    // üî• –í–ê–ñ–ù–û: –°—Ä–∞–∑—É –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ Realtime –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
    subscribeToSession(newSession.session_id);
  }
  
  // –®–ê–ì 2: –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ UI
  const userMessage = {
    id: generateId(),
    content: messageText,
    type: 'user',
    timestamp: new Date().toISOString()
  };
  setMessages(prev => [...prev, userMessage]);
  
  // –®–ê–ì 3: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "AI –ø–µ—á–∞—Ç–∞–µ—Ç..."
  setIsLoading(true);
  
  // –®–ê–ì 4: –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API
  const response = await aiDiaryService.sendMessage(
    userJwt,
    user.id,
    messageText,
    sessionId,
    'ru'
  );
  
  // –®–ê–ì 5: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä-—Ñ–æ–ª–ª–±—ç–∫
  // - 1.2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è MOCK
  // - 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è Production
  const timeout = response.data?.is_mock ? 1200 : 30000;
  const fallbackTimer = setTimeout(() => {
    if (!aiResponseReceived) {
      // –ï—Å–ª–∏ Realtime –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback
      handleFallbackResponse(response.data);
    }
  }, timeout);
  
  // –®–ê–ì 6: Realtime –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç ‚Üí –æ—Ç–º–µ–Ω—è–µ–º —Ç–∞–π–º–µ—Ä
  // (—Å–º. handleNewAIMessage)
}
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ (Realtime + Fallback)

**–î–≤–∞ –∫–∞–Ω–∞–ª–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:**

#### A. Realtime (–æ—Å–Ω–æ–≤–Ω–æ–π)

```typescript
function subscribeToSession(sessId: string) {
  const channel = supabase
    .channel(`ai_diary_session_${sessId}`)
    .on('postgres_changes', {
      event: 'INSERT',
      schema: 'public',
      table: 'ai_diary_messages',
      filter: `session_id=eq.${sessId}`
    }, (payload) => {
      const newMessage = payload.new;
      
      // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ AI —Å–æ–æ–±—â–µ–Ω–∏—è
      if (newMessage.message_type === 'ai') {
        handleNewAIMessage(newMessage);
      }
    })
    .subscribe();
}
```

#### B. Fallback (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)

```typescript
// –ï—Å–ª–∏ Realtime –º–æ–ª—á–∏—Ç –±–æ–ª—å—à–µ —Ç–∞–π–º–∞—É—Ç–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç API
const fallbackTimer = setTimeout(() => {
  if (!aiResponseReceived) {
    const aiMessage = {
      id: response.data.saved_entry_id,
      content: response.data.ai_response,
      type: 'ai',
      suggestions: response.data.suggestions,
      emotions: response.data.emotions,
      analysis: response.data.analysis,
      timestamp: new Date().toISOString()
    };
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    if (!messages.some(m => m.id === aiMessage.id)) {
      setMessages(prev => [...prev, aiMessage]);
      typeMessage(aiMessage.id, aiMessage.content);
    }
  }
}, timeout);
```

### 4. –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏ (typeMessage)

**–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞:**

```typescript
function typeMessage(messageId: string, fullText: string) {
  setIsTyping(true);
  
  // –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å:
  // - –ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–µ–∫—Å—Ç—ã (<50 —Å–∏–º–≤–æ–ª–æ–≤) ‚Üí –∑–∞–¥–µ—Ä–∂–∫–∞ 500ms
  // - –î–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã ‚Üí 30ms –Ω–∞ —Å–∏–º–≤–æ–ª
  const delay = fullText.length < 50 ? 500 : fullText.length * 30;
  
  setTimeout(() => {
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–ª–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º
    setMessages(prev => prev.map(msg => 
      msg.id === messageId 
        ? { ...msg, content: fullText }
        : msg
    ));
    setIsTyping(false);
  }, delay);
}
```

### 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

#### –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è (startNewSession)

```typescript
async function startNewSession() {
  // 1. –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ Realtime
  if (realtimeChannelRef.current) {
    supabase.removeChannel(realtimeChannelRef.current);
  }
  
  // 2. –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –≤ –ë–î
  const newSession = await aiDiarySessionsService.createSession(user.id);
  
  // 3. –°–æ—Ö—Ä–∞–Ω—è–µ–º session_id
  setSessionId(newSession.session_id);
  aiDiaryService.setCurrentSessionId(newSession.session_id);
  
  // 4. üî• –°–†–ê–ó–£ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ Realtime –¥–ª—è –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏
  subscribeToSession(newSession.session_id);
  
  // 5. –û—á–∏—â–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
  setMessages([]);
  
  // 6. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  showWelcomeMessage();
}
```

#### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (endSession)

```typescript
async function endSession() {
  if (!sessionId) return;
  
  // 1. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –ë–î
  await aiDiarySessionsService.endSession(sessionId);
  
  // 2. –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç Realtime
  if (realtimeChannelRef.current) {
    supabase.removeChannel(realtimeChannelRef.current);
  }
  
  // 3. –û—á–∏—â–∞–µ–º localStorage
  aiDiaryService.clearCurrentSessionId();
  
  // 4. –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  setSessionId(null);
  setMessages([]);
  
  // 5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  toast.success('–°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏');
}
```

---

## üë§ –°—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–µ—Ä–≤–æ–µ –ø–æ—Å–µ—â–µ–Ω–∏–µ

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É AI –î–Ω–µ–≤–Ω–∏–∫–∞
   ‚Üì
2. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç localStorage ‚Üí —Å–µ—Å—Å–∏–∏ –Ω–µ—Ç
   ‚Üì
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
   "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –≤–µ–¥–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–∏–∫–∞..."
   ‚Üì
4. –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è 4 –±–∞–∑–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
   - üòä –†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–≤–æ–∏—Ö –º—ã—Å–ª—è—Ö
   - ü§î –•–æ—á—É —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —á—É–≤—Å—Ç–≤–∞—Ö
   - üí¨ –ü–æ–≥–æ–≤–æ—Ä–∏–º –æ –ø–ª–∞–Ω–∞—Ö
   - üåü –ß—Ç–æ –º–µ–Ω—è –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—Ç
   ‚Üì
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç
   ‚Üì
6. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è ‚Üí –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "–°–µ–≥–æ–¥–Ω—è –±—ã–ª —Å—Ç—Ä–µ—Å—Å –Ω–∞ —Ä–∞–±–æ—Ç–µ"
   ‚Üì
2. –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ UI –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
   ‚Üì
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "AI –ø–µ—á–∞—Ç–∞–µ—Ç..."
   ‚Üì
4. –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ webhook
   ‚Üì
5. Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
   ‚Üì
6. Realtime –ø–æ–ª—É—á–∞–µ—Ç INSERT —Å–æ–±—ã—Ç–∏–µ
   ‚Üì
7. AI –æ—Ç–≤–µ—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø–µ—á–∞—Ç–∏:
   "–Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ —Å—Ç—Ä–µ—Å—Å..."
   ‚Üì
8. –ü–æ–¥ –æ—Ç–≤–µ—Ç–æ–º –ø–æ—è–≤–ª—è—é—Ç—Å—è 4 –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
   - üßò –ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º?
   - üòå –ü–æ–∫–∞–∂–∏ —Ç–µ—Ö–Ω–∏–∫—É —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏
   - üìù –†–∞—Å—Å–∫–∞–∂—É —á—Ç–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ
   - üí≠ –ß—Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è"
   ‚Üì
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:
   "–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é? –¢–µ–∫—É—â–∞—è –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞"
   ‚Üì
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç
   ‚Üì
4. –°—Ç–∞—Ä–∞—è —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è (status = 'ended')
   ‚Üì
5. –°–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –≤ –ë–î
   ‚Üì
6. Realtime –ø–æ–¥–ø–∏—Å–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   ‚Üì
7. –ß–∞—Ç –æ—á–∏—â–∞–µ—Ç—Å—è ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
   ‚Üì
8. Toast: "–ù–∞—á–∞—Ç–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é"
   ‚Üì
2. –î–∏–∞–ª–æ–≥: "–ó–∞–≤–µ—Ä—à–∏—Ç—å? –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è"
   ‚Üì
3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
   ‚Üì
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î: status = 'ended', ended_at = now()
   ‚Üì
5. –û—Ç–ø–∏—Å–∫–∞ –æ—Ç Realtime
   ‚Üì
6. –û—á–∏—Å—Ç–∫–∞ localStorage –∏ UI
   ‚Üì
7. Toast: "–°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏"
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 5: Fallback (–µ—Å–ª–∏ Realtime –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì
2. –ó–∞–ø—Ä–æ—Å –∫ API ‚Üí –æ—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω
   ‚Üì
3. –ñ–¥–µ–º Realtime (30 —Å–µ–∫—É–Ω–¥ –¥–ª—è prod)
   ‚Üì
4. Realtime –º–æ–ª—á–∏—Ç ‚Üí —Ç–∞–π–º–µ—Ä —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
   ‚Üì
5. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –∏–∑ API
   ‚Üì
6. AI —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ UI
   ‚Üì
7. –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏ ‚Üí suggestions
```

---

## üóÑ API –∏ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### Database Schema

#### –¢–∞–±–ª–∏—Ü–∞: `ai_diary_sessions`

```sql
CREATE TABLE ai_diary_sessions (
  session_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  status TEXT DEFAULT 'active', -- 'active' | 'ended'
  created_at TIMESTAMPTZ DEFAULT NOW(),
  ended_at TIMESTAMPTZ,
  message_count INTEGER DEFAULT 0,
  duration_seconds INTEGER,
  primary_emotion TEXT,
  themes TEXT[],
  average_mood_score DECIMAL(3,1)
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
CREATE INDEX idx_active_sessions ON ai_diary_sessions(user_id, status);
```

#### –¢–∞–±–ª–∏—Ü–∞: `ai_diary_messages`

```sql
CREATE TABLE ai_diary_messages (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id),
  session_id UUID NOT NULL REFERENCES ai_diary_sessions(session_id),
  message_type TEXT NOT NULL, -- 'user' | 'ai' | 'system'
  message TEXT,
  ai_response TEXT,
  suggestions TEXT[],
  emotions JSONB,
  analysis JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è Realtime –ø–æ–¥–ø–∏—Å–æ–∫
CREATE INDEX idx_session_messages ON ai_diary_messages(session_id, created_at);
```

### API Endpoints

#### 1. Webhook: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**Endpoint:** `POST https://mentalbalans.com/webhook/ai-diary-message`

**Request:**
```json
{
  "userJwt": "eyJhbGciOiJIUzI1NiIs...",
  "user_id": "uuid-of-user",
  "message": "–°–µ–≥–æ–¥–Ω—è –±—ã–ª —Å—Ç—Ä–µ—Å—Å",
  "session_id": "uuid-of-session",
  "locale": "ru"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "session_id": "uuid-of-session",
    "ai_response": "–Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ —Å—Ç—Ä–µ—Å—Å...",
    "suggestions": [
      "üßò –ö–∞–∫ —Å–ø—Ä–∞–≤–∏—Ç—å—Å—è —Å–æ —Å—Ç—Ä–µ—Å—Å–æ–º?",
      "üòå –ü–æ–∫–∞–∂–∏ —Ç–µ—Ö–Ω–∏–∫—É —Ä–µ–ª–∞–∫—Å–∞—Ü–∏–∏",
      "üìù –†–∞—Å—Å–∫–∞–∂—É —á—Ç–æ –±–µ—Å–ø–æ–∫–æ–∏—Ç –ø–æ–¥—Ä–æ–±–Ω–µ–µ",
      "üí≠ –ß—Ç–æ —è –º–æ–≥—É —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?"
    ],
    "emotions": {
      "primary": "fear",
      "intensity": "moderate",
      "triggers": ["—Å—Ç—Ä–µ—Å—Å", "—Ä–∞–±–æ—Ç–∞"]
    },
    "analysis": {
      "cognitive_distortions": ["catastrophizing"],
      "themes": ["—Ä–∞–±–æ—Ç–∞", "—Å—Ç—Ä–µ—Å—Å"],
      "mood_score": 4
    },
    "saved_entry_id": "uuid-of-message",
    "timestamp": "2025-01-15T10:30:00Z"
  }
}
```

#### 2. Realtime: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**Channel:** `ai_diary_session_{session_id}`

**Event:** `INSERT` –≤ —Ç–∞–±–ª–∏—Ü—É `ai_diary_messages`

**Payload:**
```json
{
  "new": {
    "id": "uuid",
    "session_id": "uuid",
    "message_type": "ai",
    "ai_response": "–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ AI",
    "suggestions": ["..."],
    "emotions": {...},
    "analysis": {...},
    "created_at": "2025-01-15T10:30:00Z"
  }
}
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

#### Production Mode (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```typescript
// src/services/ai-diary.service.ts
const USE_MOCK = false; // ‚úÖ Production

// –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
// - –†–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ webhook
// - Fallback timeout: 30 —Å–µ–∫—É–Ω–¥
// - Realtime —Ä–∞–±–æ—Ç–∞–µ—Ç
// - –ò—Å—Ç–æ—Ä–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
```

#### Mock Mode (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```typescript
// src/services/ai-diary.service.ts
const USE_MOCK = true; // üß™ Development

// –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
// - –õ–æ–∫–∞–ª—å–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
// - –ó–∞–¥–µ—Ä–∂–∫–∞: 2 —Å–µ–∫—É–Ω–¥—ã
// - Fallback timeout: 1.2 —Å–µ–∫—É–Ω–¥—ã
// - Realtime –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–∞–Ω–Ω—ã–µ –Ω–µ –≤ –ë–î)
// - –ò—Å—Ç–æ—Ä–∏—è –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
```

### Environment Variables

```env
# Supabase (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ Lovable Cloud)
VITE_SUPABASE_URL=https://xxx.supabase.co
VITE_SUPABASE_ANON_KEY=xxx

# Webhook (—Ö–∞—Ä–¥–∫–æ–¥ –≤ –∫–æ–¥–µ)
WEBHOOK_URL=https://mentalbalans.com/webhook/ai-diary-message
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Realtime

**–í–∞–∂–Ω–æ:** –î–ª—è —Ä–∞–±–æ—Ç—ã Realtime –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –í–∫–ª—é—á–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã:
```sql
ALTER PUBLICATION supabase_realtime 
ADD TABLE ai_diary_messages;
```

2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å REPLICA IDENTITY:
```sql
ALTER TABLE ai_diary_messages 
REPLICA IDENTITY FULL;
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (v14)

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞:

```typescript
// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
ü§ñ AI Diary - Send Message
  üì§ Request: { 
    userId: "xxx", 
    sessionId: "ai_diary_xxx", 
    messageLength: 25,
    timestamp: "2025-01-11T..."
  }
  üì• API Response: { 
    success: true, 
    hasAiResponse: true, 
    hasSuggestions: 4,
    hasEmotions: true,
    savedEntryId: "xxx",
    sessionId: "ai_diary_xxx"
  }

// Realtime —Å–æ–±—ã—Ç–∏—è
üì® Realtime Message Received
  Message ID: 2e48443d-aab1-4d58-8460-8fc7ff3c2f5c
  Session ID: ai_diary_1760217818526_oyo5559a7
  Has AI Response: true
  Has Suggestions: 4
  Timestamp: 2025-01-11T...

// Fallback –º–µ—Ö–∞–Ω–∏–∑–º
‚ö†Ô∏è Realtime timeout - using fallback response
Fallback data: { 
  messageId: "xxx",
  hasResponse: true 
}

// –û—à–∏–±–∫–∏
‚ùå AI Diary Error
  Error details: { message: "...", stack: "..." }
  Response status: 500
  Response data: { error: "..." }
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è API –æ—Ç–≤–µ—Ç–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–æ–≤:

- ‚úÖ –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (`typeof response.data === 'object'`)
- ‚úÖ –ü–æ–ª–µ `success: true`
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: `ai_response`, `suggestions`, `emotions`, `analysis`, `session_id`
- ‚ö†Ô∏è –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª—è—Ö (–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É)

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ—à–∏–±–æ–∫:

| –ö–æ–¥ | –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é | –ö–æ–Ω—Å–æ–ª—å |
|-----|------------------------|---------|
| 401 | "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è" | Response status + data |
| 500 | "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ" | Full error details |
| Network | "–ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ" | No response received |
| Other | –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ | Request setup error |

### Debug –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

#### 1. Copy JWT Button
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü—Ä–∞–≤—ã–π –≤–µ—Ä—Ö–Ω–∏–π —É–≥–æ–ª AI Diary —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–∑–µ–ª–µ–Ω–∞—è –∫–Ω–æ–ø–∫–∞)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è n8n webhook
- **–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:**
  ```powershell
  $JWT = "eyJhbGci..."
  $USER_ID = "808fb59f-..."
  ```
- **–ì–¥–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –í n8n –¥–ª—è debug –∏–ª–∏ –≤ PowerShell –¥–ª—è curl –∑–∞–ø—Ä–æ—Å–æ–≤

#### 2. –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **–§–∞–π–ª:** `public/test-ai-diary.html`
- **URL:** `http://localhost:8080/test-ai-diary.html`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Supabase
  - ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–π AI Diary —Å–µ—Å—Å–∏–∏
  - ‚úÖ –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç webhook —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
  - ‚úÖ –ü–æ–ª–Ω—ã–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç (–≤—Å–µ –≤ –æ–¥–Ω–æ–º)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
  1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
  2. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é"
  3. –ù–∞–∂–º–∏—Ç–µ "–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∫ webhook"
  4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏ –∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ

#### 3. DevTools Console —Ç–µ—Å—Ç—ã
–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏
localStorage.getItem('ai_diary_session_id');

// –ü—Ä–æ–≤–µ—Ä–∫–∞ Supabase —Å–µ—Å—Å–∏–∏
(await supabase.auth.getSession()).data.session;

// –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç (–Ω–∞ test-ai-diary.html)
runFullTest();
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|---------|
| "AI –ø–µ—á–∞—Ç–∞–µ—Ç..." –∑–∞–≤–∏—Å–∞–µ—Ç | Realtime –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω / —Ç–∞–π–º–∞—É—Ç 30—Å –∏—Å—Ç–µ–∫ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å n8n executions |
| –î—É–±–ª–∏–∫–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π | Realtime + Fallback —Å—Ä–∞–±–æ—Ç–∞–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ | –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –ø–æ `id` |
| –ù–µ—Ç –æ—Ç–≤–µ—Ç–∞ –≤ Mock —Ä–µ–∂–∏–º–µ | `USE_MOCK = true` –Ω–æ Realtime –∂–¥–µ—Ç INSERT | –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å `USE_MOCK = false` |
| –ò—Å—Ç–æ—Ä–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è | –ù–µ–≤–µ—Ä–Ω—ã–π `session_id` –≤ localStorage | –û—á–∏—Å—Ç–∏—Ç—å localStorage, –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é |
| 401 Unauthorized | JWT —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ | –ü–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ |
| –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ | API –≤–µ—Ä–Ω—É–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å n8n workflow, –ª–æ–≥–∏ webhook |

### Production Checklist

–ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º —É–±–µ–¥–∏—Ç–µ—Å—å:
- [x] `USE_MOCK = false` –≤ `ai-diary.service.ts`
- [x] Fallback timeout = 30000 (30 —Å–µ–∫—É–Ω–¥)
- [x] Realtime –ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `ai_diary_messages`
- [x] n8n workflow v14 –∞–∫—Ç–∏–≤–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –í—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ API –æ—Ç–≤–µ—Ç–µ
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ —á–∏—Ç–∞–µ–º–æ
- [x] –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –°–æ–±–∏—Ä–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ù–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–∏:**
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π (`message_count`)
- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ (`duration_seconds`)
- –û—Å–Ω–æ–≤–Ω–∞—è —ç–º–æ—Ü–∏—è (`primary_emotion`)
- –¢–µ–º—ã —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤ (`themes[]`)
- –°—Ä–µ–¥–Ω–∏–π mood score (`average_mood_score`)

**–ù–∞ —É—Ä–æ–≤–Ω–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
- –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (`message_type`)
- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (`created_at`)
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (`emotions`)
- –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è (`analysis.cognitive_distortions`)

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

```typescript
// src/hooks/useAIDiaryAnalytics.ts
const { stats, isLoading } = useAIDiaryAnalytics();

// stats —Å–æ–¥–µ—Ä–∂–∏—Ç:
{
  totalSessions: 15,
  activeSessions: 1,
  totalMessages: 234,
  averageMessages: 15.6,
  averageDuration: 1200, // —Å–µ–∫—É–Ω–¥—ã
  lastActivity: "2025-01-15T10:30:00Z",
  topEmotions: ["trust", "joy", "fear"]
}
```

---

## üöÄ Roadmap –∏ —É–ª—É—á—à–µ–Ω–∏—è

### v15 - –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- [ ] –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (‚úì/pending)
- [ ] –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –≤ PDF/TXT
- [ ] –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º
- [ ] –¢–µ–≥–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–µ—Å—Å–∏–π
- [ ] –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ—Ü–∏–π (–≥—Ä–∞—Ñ–∏–∫–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥)
- [ ] –ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥/–≤—ã–≤–æ–¥ (Web Speech API)
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (en, uk)
- [ ] Dashboard —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π —ç–º–æ—Ü–∏–π
- [ ] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö –∏—Å–∫–∞–∂–µ–Ω–∏—è—Ö
- [ ] –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –≤–µ–¥–µ–Ω–∏–∏ –¥–Ω–µ–≤–Ω–∏–∫–∞

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- [ ] –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π
- [ ] Lazy loading –∏—Å—Ç–æ—Ä–∏–∏
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ AI
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Realtime (batching)
- [ ] Service Worker –¥–ª—è offline —Ä–µ–∂–∏–º–∞

---

## üìù Changelog

### v14.0 (Production Ready) - 2025-01-11

‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è API –æ—Ç–≤–µ—Ç–æ–≤
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (401, 500, network)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–º–æ—Ü–∏–π —Å —ç–º–æ–¥–∑–∏ (üòä, ü§ó, üò∞, etc.)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ mood score (—à–∫–∞–ª–∞ 1-10)
- –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ `/public/test-ai-diary.html`
- Debug –∫–Ω–æ–ø–∫–∞ Copy JWT –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

‚úÖ **–£–ª—É—á—à–µ–Ω–æ:**
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç console.group() –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –≤ API –æ—Ç–≤–µ—Ç–µ
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –±–æ–ª–µ–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- USE_MOCK –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ false –¥–ª—è production
- Fallback timeout —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫

### v1.2.0

‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π fallback timeout (1.2s –¥–ª—è mock, 30s –¥–ª—è prod)
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ Realtime –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏
- –§–ª–∞–≥ `is_mock` –≤ –æ—Ç–≤–µ—Ç–∞—Ö API
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- –ó–∞–≤–∏—Å–∞–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ "AI –ø–µ—á–∞—Ç–∞–µ—Ç..." –≤ mock —Ä–µ–∂–∏–º–µ
- –ü—Ä–æ–ø—É—Å–∫ Realtime —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Å—Å–∏–∏
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É Realtime –∏ Fallback

### v1.1.0

‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ `AIDiaryStats`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ (–Ω–æ–≤–∞—è/–∑–∞–≤–µ—Ä—à–∏—Ç—å)
- –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏ –¥–ª—è AI –æ—Ç–≤–µ—Ç–æ–≤
- QuickSuggestions –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### v1.0.0

‚úÖ **–†–µ–ª–∏–∑:**
- –ë–∞–∑–æ–≤—ã–π —á–∞—Ç —Å AI
- Realtime –ø–æ–¥–ø–∏—Å–∫–∏
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** `/docs/AI-DIARY.md`
- **–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥:** `/src/components/dashboard/ai-diary/`
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è, n8n webhook)

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: 2025-01-11*
*–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: 14.0 (Production Ready)*